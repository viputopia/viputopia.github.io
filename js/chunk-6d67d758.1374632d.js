(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d67d758"],{ba4b:function(t,s,a){"use strict";a("d77a")},ccfd:function(t,s,a){"use strict";a.r(s);var n=function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("van-overlay",{attrs:{show:t.show},on:{click:function(s){t.show=!1}}},[n("div",{staticClass:"trade-confirm",on:{click:function(t){t.stopPropagation()}}},[n("div",{staticClass:"title"},[t._v("交易确认")]),n("div",{staticClass:"container"},[n("div",{staticClass:"info"},[n("img",{attrs:{src:a("f5da")}}),n("div",[n("span",[t._v("汉字能量")]),n("span",[t._v("汉字能量 #"+t._s(t.id))]),n("span",[t._v("代币ID："),n("span",[t._v(t._s(t.id))])])])]),n("div",{staticClass:"payment"},[n("div",{staticClass:"method"},[n("span",[t._v("支付方式")]),n("div",[n("span",{class:"UPC"===t.method?"active":"",on:{click:function(s){return t.switchMethod("UPC")}}},[t._v("UPC")]),n("span",{class:"UPC"===t.method?"":"active",on:{click:function(s){return t.switchMethod("USDT")}}},[t._v("USDT")])])]),n("div",{staticClass:"amount"},[n("span",[t._v("总付款")]),n("div",[n("span",[t._v(t._s(("UPC"===t.method?t.paymentUPC:t.paymentUSDT).toFixed(4)))]),n("span",[t._v("($"+t._s("UPC"===t.method?t.paymentUSD:t.paymentUSDT)+")")])])]),n("div",{staticClass:"amount"},[n("span",[t._v("钱包中的"+t._s(t.method))]),n("div",[n("span",[t._v(t._s(("UPC"===t.method?t.upcBalance:t.usdtBalance).toFixed(4)))]),n("span",[t._v("($"+t._s(("UPC"===t.method?t.balanceUSD:t.usdtBalance).toFixed(0))+")")])])])]),n("van-button",{on:{click:t.mintNft}},[t._v(t._s(t.btnText))])],1)])])},e=[],o=(a("a9e3"),a("b680"),a("96cf"),a("1da1")),c={props:{paymentUSDT:[Number,String]},data:function(){return{show:!1,method:"UPC",paymentUPC:0,paymentUSD:0,id:0,upcBalance:0,usdtBalance:0,balanceUSD:0,upcAllowance:"0".toBNs(),usdtAllowance:"0".toBNs(),trading:!1}},computed:{btnText:function(){return"UPC"===this.method&&this.upcAllowance.lt(this.paymentUPC)?"授权UPC":"USDT"===this.method&&this.usdtAllowance.lt(this.paymentUSDT)?"授权USDT":"确定"}},created:function(){this.$contracts&&this.init()},methods:{switchMethod:function(t){this.method=t},open:function(){this.show=!0},approve:function(){var t=this;this.trading=!0,this.$contracts[this.method].methods.approve(this.$contracts.NFTFactory._address,("UPC"===this.method?this.paymentUPC:this.paymentUSDT).toWei().toBNs().times(10).toFixed()).send({from:this.$address}).on("transactionHash",(function(s){vant.Toast.loading({message:t.$t("app.text6"),loadingType:"spinner",forbidClick:!0,duration:0})})).on("receipt",function(){var s=Object(o["a"])(regeneratorRuntime.mark((function s(a){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if("UPC"!==t.method){s.next=6;break}return s.next=3,t.$contracts.UPC.methods.allowance(t.$address,t.$contracts.NFTFactory._address).call({from:t.$address});case 3:t.upcAllowance=s.sent.fromWei().toBNs(),s.next=9;break;case 6:return s.next=8,t.$contracts.USDT.methods.allowance(t.$address,t.$contracts.NFTFactory._address).call({from:t.$address});case 8:t.usdtAllowance=s.sent.fromWei().toBNs();case 9:vant.Toast.clear(),t.trading=!1;case 11:case"end":return s.stop()}}),s)})));return function(t){return s.apply(this,arguments)}}()).on("error",(function(s){console.log(s),vant.Toast.clear(),t.trading=!1}))},mintNft:function(){var t=this;if(this.trading)return!1;if("UPC"===this.method&&this.upcAllowance.lt(this.paymentUPC))return this.approve();if("USDT"===this.method&&this.usdtAllowance.lt(this.paymentUSDT))return this.approve();if("UPC"===this.method&&this.upcBalance.toBNs().lt(this.paymentUPC))return vant.Toast.fail("UPC余额不足！");if("USDT"===this.method&&this.usdtBalance.toBNs().lt(this.paymentUSDT))return vant.Toast.fail("USDT余额不足！");this.trading=!0;var s=this.$contracts.NFTFactory.methods.mintNft(this.$contracts[this.method]._address,("UPC"===this.method?this.paymentUPC:this.paymentUSDT).toWei());s.call({from:this.$address},(function(a,n){a||s.send({from:t.$address}).on("transactionHash",(function(s){vant.Toast.loading({message:t.$t("app.text6"),loadingType:"spinner",forbidClick:!0,duration:0})})).on("receipt",(function(s){vant.Toast.clear(),vant.Toast.success("交易成功！"),t.show=!1,t.trading=!1})).on("error",(function(s){console.log(s),vant.Toast.clear(),t.trading=!1}))}))},init:function(){var t=this;this.$contracts.UPC.methods.allowance(this.$address,this.$contracts.NFTFactory._address).call((function(s,a){s||(t.upcAllowance=a.fromWei().toBNs())})),this.$contracts.USDT.methods.allowance(this.$address,this.$contracts.NFTFactory._address).call((function(s,a){s||(t.usdtAllowance=a.fromWei().toBNs())})),this.$contracts.NFTToken.methods.current().call((function(s,a){s||(t.id=0===Number(a)?Number(a)+1:a)})),this.$contracts.NFTFactory.methods.getUpcNeed().call((function(s,a){s||(t.paymentUPC=a.fromWei(),t.$contracts.Router.methods.getAmountsOut(a,[t.$contracts.UPC._address,t.$contracts.USDT._address]).call({from:t.$address},(function(s,a){s||(t.paymentUSD=a[1].fromWei().toFixed(0))})))})),this.$contracts.UPC.methods.balanceOf(this.$address).call((function(s,a){s||(t.upcBalance=a.fromWei(),a>0&&t.$contracts.Router.methods.getAmountsOut(a,[t.$contracts.UPC._address,t.$contracts.USDT._address]).call({from:t.$address},(function(s,a){s||(t.balanceUSD=a[1].fromWei().toFixed(0))})))})),this.$contracts.USDT.methods.balanceOf(this.$address).call((function(s,a){s||(t.usdtBalance=a.fromWei())}))}}},i=c,r=i,d=(a("ba4b"),a("2877")),l=Object(d["a"])(r,n,e,!1,null,"2c46f0d4",null);s["default"]=l.exports},d77a:function(t,s,a){},f5da:function(t,s,a){t.exports=a.p+"img/confirm-logo.c437f13a.svg"}}]);